<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom"><generator uri="http://jekyllrb.com" version="3.1.3">Jekyll</generator><link href="/feed.xml" rel="self" type="application/atom+xml" /><link href="/" rel="alternate" type="text/html" /><updated>2016-06-28T15:33:08+08:00</updated><id>/</id><title>MK in Apple</title><subtitle>MK的技术博客.</subtitle><author><name>M0nk1y</name><email>monkey19911021@gmail.com</email></author><entry><title>应用扩展—— photo editing extension</title><link href="/2016/06/27/PhotoEditingExtension" rel="alternate" type="text/html" title="应用扩展—— `photo editing extension`" /><published>2016-06-27T00:00:00+08:00</published><updated>2016-06-27T00:00:00+08:00</updated><id>/2016/06/27/应用扩展—— `Photo Editing Extension`</id><content type="html" xml:base="/2016/06/27/PhotoEditingExtension">&lt;p&gt;&lt;img src=&quot;/images/MKPhotoExtension/img1.PNG&quot; alt=&quot;截图1&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;section&quot;&gt;1. 开发流程梗概&lt;/h2&gt;

&lt;h3 id=&quot;section-1&quot;&gt;1.1. 创建扩展&lt;/h3&gt;

&lt;h3 id=&quot;startcontenteditingwithinput&quot;&gt;1.2. 处理开始编辑照片时的事件（startContentEditingWithInput）&lt;/h3&gt;

&lt;h3 id=&quot;section-2&quot;&gt;1.3. 对预览照片进行编辑，添加滤镜、模糊，调整亮度、饱和度、对比度等&lt;/h3&gt;

&lt;h3 id=&quot;section-3&quot;&gt;1.4. 处理完成编辑照片时的事件，对源图进行同样的编辑，把修改后的源图保存到某个位置。&lt;/h3&gt;

&lt;h2 id=&quot;section-4&quot;&gt;2. 创建照片编辑扩展&lt;/h2&gt;
&lt;p&gt;关于如何创建一个扩展请参考&lt;a href=&quot;http://mkapple.cn/2016/06/20/TodayExtension&quot;&gt;这里&lt;/a&gt;的第二步骤, 我们要创建的是 Photo Editing Extension 。
&lt;br /&gt;
&lt;img src=&quot;/images/MKPhotoExtension/img2.png&quot; alt=&quot;截图2&quot; /&gt;&lt;/p&gt;

&lt;p&gt;创建完后，我们直接运行扩展。
&lt;br /&gt;
&lt;img src=&quot;/images/MKPhotoExtension/img3.gif&quot; alt=&quot;截图3&quot; /&gt;&lt;/p&gt;

&lt;p&gt;出现了一个 Hello World 界面。&lt;/p&gt;

&lt;h2 id=&quot;section-5&quot;&gt;3. 设置可编辑数据类型&lt;/h2&gt;
&lt;p&gt;在扩展的 Info.plist 文件中找到 NSExtension 属性，该属性结构如下：
&lt;br /&gt;
&lt;img src=&quot;/images/MKPhotoExtension/img4.png&quot; alt=&quot;截图4&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;section-6&quot;&gt;4. 开始编辑前&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;- (BOOL)canHandleAdjustmentData:&lt;/code&gt; ，当照片被编辑过时调用，方法有一个参数：&lt;code class=&quot;highlighter-rouge&quot;&gt;PHAdjustmentData&lt;/code&gt;，里面包含了上次编辑时所使用的编辑器的数据：
&lt;br /&gt;
4.1. &lt;code class=&quot;highlighter-rouge&quot;&gt;formatIdentifier&lt;/code&gt;，编辑器的唯一ID &lt;br /&gt;
4.2. &lt;code class=&quot;highlighter-rouge&quot;&gt;formatVersion&lt;/code&gt;，编辑器的版本号 &lt;br /&gt;
4.3. &lt;code class=&quot;highlighter-rouge&quot;&gt;data&lt;/code&gt;，编辑器保存的数据，自定义数据 &lt;br /&gt;
&lt;br /&gt;
返回值： &lt;br /&gt;
4.4. &lt;code class=&quot;highlighter-rouge&quot;&gt;NO&lt;/code&gt;, 扩展编辑的是被编辑过的效果图 &lt;br /&gt;
4.5. &lt;code class=&quot;highlighter-rouge&quot;&gt;YES&lt;/code&gt;, 扩展编辑的是没有任何改动的原图 &lt;br /&gt;&lt;/p&gt;

&lt;p&gt;例：&lt;/p&gt;

&lt;div class=&quot;language-objc highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;BOOL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;canHandleAdjustmentData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PHAdjustmentData&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;adjustmentData&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;BOOL&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;formatIdentifier&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;isEqualToString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;adjustmentData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;formatIdentifier&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;formatVersion&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;isEqualToString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;adjustmentData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;formatVersion&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;currentFilterName&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSString&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;alloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;initWithData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;adjustmentData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;encoding&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSUTF8StringEncoding&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;section-7&quot;&gt;5. 开始编辑&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;- (void)startContentEditingWithInput:placeholderImage:&lt;/code&gt;，当进入到编辑界面时调用，&lt;code class=&quot;highlighter-rouge&quot;&gt;contentEditingInput&lt;/code&gt; 属性包含了照片的类型、地理位置、预览图和原图位置等信息。&lt;/p&gt;

&lt;h2 id=&quot;section-8&quot;&gt;6. 完成编辑&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;- (void)finishContentEditingWithCompletionHandler:&lt;/code&gt;，在这方法里主要需要完成两个任务：
&lt;br /&gt;
6.1. 设置输出的 adjustmentData, 即把照片编辑的信息保存起来，放到 completionHandler 里处理。
&lt;br /&gt;
6.2. 对原图进行相同的编辑&lt;/p&gt;

&lt;div class=&quot;language-objc highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;finishContentEditingWithCompletionHandler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PHContentEditingOutput&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;completionHandler&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;dispatch_async&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dispatch_get_global_queue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DISPATCH_QUEUE_PRIORITY_DEFAULT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;PHContentEditingOutput&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;output&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PHContentEditingOutput&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;alloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;initWithContentEditingInput&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;input&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
        
        &lt;span class=&quot;c1&quot;&gt;//1. 设置输出的adjustmentData
&lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;PHAdjustmentData&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;adjustmentData&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PHAdjustmentData&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;alloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;initWithFormatIdentifier&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;formatIdentifier&lt;/span&gt;
                                                                                &lt;span class=&quot;nf&quot;&gt;formatVersion&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;formatVersion&lt;/span&gt;
                                                                                         &lt;span class=&quot;nf&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;currentFilterName&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;dataUsingEncoding&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSUTF8StringEncoding&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]];&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;output&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;adjustmentData&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;adjustmentData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        
        &lt;span class=&quot;c1&quot;&gt;//2. 对原图进行相同的编辑
&lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;CIImage&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fullSizeImage&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CIImage&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;imageWithContentsOfURL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_input&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fullSizeImageURL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
        
        &lt;span class=&quot;n&quot;&gt;UIGraphicsBeginImageContext&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fullSizeImage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;extent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;CIImage&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;filterImage&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;MKImageUtil&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;filterWithOriginalImage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fullSizeImage&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;filterName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;currentFilterName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//添加滤镜
&lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;UIImage&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;drawImage&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UIImage&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;imageWithCIImage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;filterImage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;drawImage&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;drawInRect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fullSizeImage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;extent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;UIImage&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;outputImage&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;UIGraphicsGetImageFromCurrentImageContext&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;NSData&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;jpegData&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;UIImageJPEGRepresentation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;outputImage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;UIGraphicsEndImageContext&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
        
        &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;jpegData&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;writeToURL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;output&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;renderedContentURL&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;atomically&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;YES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
        
        &lt;span class=&quot;n&quot;&gt;completionHandler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;output&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;section-9&quot;&gt;7. 取消编辑&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;- (BOOL)shouldShowCancelConfirmation&lt;/code&gt;, 返回 YES，则取消编辑是提醒用户是否取消。&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;
Demo: &lt;a href=&quot;https://github.com/monkey19911021/MKPhotoEditingExtension.git&quot;&gt;MKPhotoEditingExtension&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;
演示：
&lt;br /&gt;
&lt;img src=&quot;/images/MKPhotoExtension/img5.gif&quot; alt=&quot;截图5&quot; /&gt;
&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;参考链接：
&lt;br /&gt;
&lt;a href=&quot;http://objccn.io/issue-21-5/&quot;&gt;照片扩展&lt;/a&gt;
&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;P.S. 喜欢就分享或者点个赞呗&lt;/p&gt;

&lt;!-- 多说评论框 start --&gt;
&lt;div class=&quot;ds-thread&quot; data-thread-key=&quot;PhotoEditingExtension&quot; data-title=&quot;PhotoEditingExtension&quot; data-url=&quot;http://mkapple.cn/2016/06/27/PhotoEditingExtension&quot;&gt;&lt;/div&gt;
&lt;!-- 多说评论框 end --&gt;
&lt;!-- 多说公共JS代码 start (一个网页只需插入一次) --&gt;
&lt;script type=&quot;text/javascript&quot;&gt;
var duoshuoQuery = {short_name:&quot;mkapple&quot;};
	(function() {
		var ds = document.createElement(&#39;script&#39;);
		ds.type = &#39;text/javascript&#39;;ds.async = true;
		ds.src = (document.location.protocol == &#39;https:&#39; ? &#39;https:&#39; : &#39;http:&#39;) + &#39;//static.duoshuo.com/embed.js&#39;;
		ds.charset = &#39;UTF-8&#39;;
		(document.getElementsByTagName(&#39;head&#39;)[0] 
		 || document.getElementsByTagName(&#39;body&#39;)[0]).appendChild(ds);
	})();
	&lt;/script&gt;

&lt;!-- 多说公共JS代码 end --&gt;</content><author><name>M0nk1y</name><email>monkey19911021@gmail.com</email></author><category term="PhotoEditingExtension" /><category term="Extension" /><summary></summary></entry><entry><title>应用扩展—— share extension</title><link href="/2016/06/23/ShareExtension" rel="alternate" type="text/html" title="应用扩展—— `share extension`" /><published>2016-06-23T00:00:00+08:00</published><updated>2016-06-23T00:00:00+08:00</updated><id>/2016/06/23/应用扩展—— `Share Extension`</id><content type="html" xml:base="/2016/06/23/ShareExtension">&lt;p&gt;&lt;img src=&quot;/images/ShareExtension/img1.PNG&quot; alt=&quot;截图1&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;section&quot;&gt;1. 先来介绍几个概念&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;App Extension：&lt;/strong&gt; 扩展&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Containing app：&lt;/strong&gt; 提供扩展的应用称之为容器应用&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Host app：&lt;/strong&gt; 调用扩展的应用称之为载体应用&lt;/p&gt;

&lt;p&gt;容器应用可以同时是载体应用，即容器容器应用也可以调用自身的扩展。
&lt;br /&gt;
&lt;img src=&quot;/images/ShareExtension/img6.png&quot; alt=&quot;截图6&quot; /&gt;
&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;section-1&quot;&gt;2. 创建分享扩展&lt;/h2&gt;
&lt;p&gt;关于如何创建一个扩展请参考&lt;a href=&quot;http://mkapple.cn/2016/06/20/TodayExtension&quot;&gt;这里&lt;/a&gt;的第二步骤, 我们要创建的是 Share Extension 。
&lt;br /&gt;	
P.S. 说实话，分享扩展这东西除了在社交应用或者一些特别应用之外没啥用处了
&lt;br /&gt;
&lt;img src=&quot;/images/ShareExtension/img2.png&quot; alt=&quot;截图2&quot; /&gt;&lt;/p&gt;

&lt;p&gt;创建完后，我们运行扩展。然后用 Safari 打开：http://mkapple.cn。点击 Safari 的分享按钮。发现扩展出现在分享选择栏里了。
&lt;br /&gt;
&lt;img src=&quot;/images/ShareExtension/img3.png&quot; alt=&quot;截图3&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/ShareExtension/img4.png&quot; alt=&quot;截图4&quot; /&gt;
&lt;br /&gt;
可以发现苹果已经为你做好了一个基本的分享界面了。&lt;/p&gt;

&lt;h2 id=&quot;section-2&quot;&gt;3. 设置分享的数据类型&lt;/h2&gt;
&lt;p&gt;在扩展的 Info.plist 文件中找到 NSExtension 属性，该属性结构如下：
&lt;br /&gt;
&lt;img src=&quot;/images/ShareExtension/img5.png&quot; alt=&quot;截图5&quot; /&gt;
&lt;br /&gt;
各规则属性可以参考&lt;a href=&quot;https://developer.apple.com/library/ios/documentation/General/Reference/InfoPlistKeyReference/Articles/SystemExtensionKeys.html#//apple_ref/doc/uid/TP40014212-SW11&quot;&gt;官方文档&lt;/a&gt;，限制分享的图片、视频、网站地址的数量。&lt;/p&gt;

&lt;h2 id=&quot;section-3&quot;&gt;4. 验证用户输入&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;SLComposeServiceViewController&lt;/code&gt; —— 默认提供的标准化分享界面，提供以下属性和方法：
&lt;br /&gt;
&lt;code class=&quot;highlighter-rouge&quot;&gt;NSString *contentText&lt;/code&gt; —— 分享文本编辑框的内容&lt;br /&gt;
&lt;code class=&quot;highlighter-rouge&quot;&gt;NSNumber *charactersRemaining&lt;/code&gt; —— 设置剩下输入的内容字数&lt;br /&gt;
&lt;code class=&quot;highlighter-rouge&quot;&gt;- (BOOL)isContentValid&lt;/code&gt; —— 文本框内容改变时调用，返回 NO 则 Post 按钮禁用&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;例：&lt;/p&gt;

&lt;div class=&quot;language-objc highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;BOOL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;isContentValid&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;NSInteger&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;textLength&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;contentText&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;charactersRemaining&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;maxCharactersAllowed&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;textLength&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;charactersRemaining&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;integerValue&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NO&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;YES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;section-4&quot;&gt;5. 提交分享&lt;/h2&gt;
&lt;p&gt;提交分享会调用 &lt;code class=&quot;highlighter-rouge&quot;&gt;- (void)didSelectPost&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-objc highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;didSelectPost&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;//上传分享数据
&lt;/span&gt;    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;uploadData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;//提交分享请求
&lt;/span&gt;    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;extensionContext&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;completeRequestReturningItems&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:@[]&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;completionHandler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;section-5&quot;&gt;6. 取消分享&lt;/h2&gt;
&lt;p&gt;取消分享会调用 &lt;code class=&quot;highlighter-rouge&quot;&gt;- (void)didSelectCancel&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-objc highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;didSelectCancel&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;NSError&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;error&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSError&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;errorWithDomain&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;@&quot;MK&quot;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;code&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;500&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;userInfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;@&quot;error&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;@&quot;用户取消&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}];&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;//取消分享请求
&lt;/span&gt;    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;extensionContext&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;cancelRequestWithError&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;section-6&quot;&gt;7. 上传数据前的提取数据&lt;/h2&gt;
&lt;p&gt;介绍几个属性和方法：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;UIViewController&lt;/code&gt; 的 &lt;code class=&quot;highlighter-rouge&quot;&gt;extensionContext&lt;/code&gt;，类是  &lt;a href=&quot;https://developer.apple.com/library/ios/documentation/Foundation/Reference/NSExtensionContext_Class/index.html#//apple_ref/occ/cl/NSExtensionContext&quot;&gt;NSExtensionContext&lt;/a&gt;
&lt;br /&gt;&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;NSExtensionContext &lt;/code&gt; 的 &lt;code class=&quot;highlighter-rouge&quot;&gt;inputItems&lt;/code&gt;，元素类型是&lt;a href=&quot;https://developer.apple.com/library/ios/documentation/Foundation/Reference/NSExtensionItem_Class/index.html#//apple_ref/occ/cl/NSExtensionItem&quot;&gt;NSExtensionItem&lt;/a&gt; 的数组，但实际上只有一个元素。
&lt;br /&gt;&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;NSExtensionItem&lt;/code&gt; 的 &lt;code class=&quot;highlighter-rouge&quot;&gt;attachments&lt;/code&gt; 元素类型是 &lt;a href=&quot;https://developer.apple.com/library/ios/documentation/Foundation/Reference/NSItemProvider_Class/index.html#//apple_ref/occ/cl/NSItemProvider&quot;&gt;NSItemProvider&lt;/a&gt; 的数组，分享的图片、视频、URL 都封装在这个对象中。
&lt;br /&gt;&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;NSItemProvider&lt;/code&gt; 的 &lt;code class=&quot;highlighter-rouge&quot;&gt;registeredTypeIdentifiers&lt;/code&gt; 元素类型是 NSString 的数组，但实际也只有一个类型，表示封装的数据的类型，格式为 &lt;a href=&quot;https://developer.apple.com/library/ios/documentation/General/Conceptual/DevPedia-CocoaCore/UniformTypeIdentifier.html#//apple_ref/doc/uid/TP40008195-CH60&quot;&gt;Uniform Type Identifier&lt;/a&gt;， 简称UTI，&lt;a href=&quot;https://developer.apple.com/library/ios/documentation/Miscellaneous/Reference/UTIRef/Articles/System-DeclaredUniformTypeIdentifiers.html#//apple_ref/doc/uid/TP40009259&quot;&gt;详细列表&lt;/a&gt;，UIT 类型的常量 &lt;a href=&quot;https://developer.apple.com/library/ios/documentation/MobileCoreServices/Reference/UTTypeRef/index.html#//apple_ref/doc/constant_group/UTI_Text_Types&quot;&gt;UTType Reference&lt;/a&gt;
&lt;br /&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;例：&lt;/p&gt;

&lt;div class=&quot;language-objc highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;//提取数据
&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fetchItemDataAtBackground&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;//后台执行
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dispatch_async&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dispatch_get_global_queue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DISPATCH_QUEUE_PRIORITY_DEFAULT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        
        &lt;span class=&quot;n&quot;&gt;NSArray&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSExtensionItem&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;itemArray&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;extensionContext&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;inputItems&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        
        &lt;span class=&quot;c1&quot;&gt;//实际上只有一个 NSExtensionItem 对象
&lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;NSExtensionItem&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;item&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;itemArray&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;firstObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;NSArray&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSItemProvider&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;providerArray&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;attachments&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        
        &lt;span class=&quot;c1&quot;&gt;//输出 userInfo 或者 attachments 就可以看到 dataType 对应的字符串是啥了
&lt;/span&gt;        &lt;span class=&quot;c1&quot;&gt;//NSLog(@&quot;userInfo: %@&quot;, item.userInfo);
&lt;/span&gt;        
        &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSItemProvider&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;provider&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;providerArray&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
            &lt;span class=&quot;c1&quot;&gt;//实际上一个NSItemProvider里也只有一种数据类型
&lt;/span&gt;            &lt;span class=&quot;n&quot;&gt;NSString&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dataType&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;provider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;registeredTypeIdentifiers&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;firstObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dataType&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;isEqualToString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;@&quot;public.image&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]){&lt;/span&gt;
                
                &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;provider&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;loadItemForTypeIdentifier&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dataType&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;options&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;completionHandler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UIImage&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NSError&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;attachImageArray&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;addObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;}];&lt;/span&gt;
                
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dataType&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;isEqualToString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;@&quot;public.plain-text&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]){&lt;/span&gt;
                
                &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;provider&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;loadItemForTypeIdentifier&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dataType&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;options&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;completionHandler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSString&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plainStr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NSError&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;attachStringArray&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;addObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;plainStr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;}];&lt;/span&gt;
                
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dataType&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;isEqualToString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;@&quot;public.url&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]){&lt;/span&gt;
                
                &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;provider&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;loadItemForTypeIdentifier&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dataType&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;options&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;completionHandler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSURL&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NSError&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;attachURLArray&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;addObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;}];&lt;/span&gt;
                
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        
    &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;section-7&quot;&gt;8. 上传数据&lt;/h2&gt;
&lt;p&gt;首先，当点击 post 发布之后，扩展就被终止了，但是上传任务仍然在后台工作，它的图片、视频等数据缓存在哪呢，这时就需要容器应用提供一个缓存容器了，这时，就需要 group 了。
&lt;br /&gt;
&lt;code class=&quot;highlighter-rouge&quot;&gt;TARGETS&lt;/code&gt; ——&amp;gt; &lt;code class=&quot;highlighter-rouge&quot;&gt;主应用&lt;/code&gt; ——&amp;gt; &lt;code class=&quot;highlighter-rouge&quot;&gt;Capabilities&lt;/code&gt; ——&amp;gt; &lt;code class=&quot;highlighter-rouge&quot;&gt;App Group&lt;/code&gt;
&lt;br /&gt;&lt;/p&gt;

&lt;div class=&quot;language-objc highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;NSString&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;configName&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;@&quot;com.donlinks.MKShareExtension.BackgroundSessionConfig&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;NSURLSessionConfiguration&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sessionConfig&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSURLSessionConfiguration&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;backgroundSessionConfigurationWithIdentifier&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;configName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;sessionConfig&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sharedContainerIdentifier&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;@&quot;group.MKShareExtension&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    
&lt;span class=&quot;n&quot;&gt;NSURLSession&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;shareSession&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSURLSession&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;sessionWithConfiguration&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sessionConfig&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;我把数据封装成 JSON 并上传到 &lt;a href=&quot;http://requestb.in/&quot;&gt;requestb.in&lt;/a&gt; 。该网站不是 https 的，需要在扩展的 Info.plist 加上允许所有网络请求：
&lt;br /&gt;
&lt;img src=&quot;/images/ShareExtension/img8.png&quot; alt=&quot;截图8&quot; /&gt;
&lt;br /&gt;&lt;/p&gt;

&lt;div class=&quot;language-xml highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;key&amp;gt;&lt;/span&gt;NSAppTransportSecurity&lt;span class=&quot;nt&quot;&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;dict&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;nt&quot;&gt;&amp;lt;key&amp;gt;&lt;/span&gt;NSAllowsArbitraryLoads&lt;span class=&quot;nt&quot;&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;nt&quot;&gt;&amp;lt;true/&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/dict&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;br /&gt;
演示：
&lt;br /&gt;
&lt;img src=&quot;/images/ShareExtension/img6.gif&quot; alt=&quot;截图6&quot; /&gt;
&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;上传完成后到 requestb.in 可以看到
&lt;img src=&quot;/images/ShareExtension/img7.png&quot; alt=&quot;截图7&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;section-8&quot;&gt;9. 自定义分享界面思路&lt;/h2&gt;
&lt;p&gt;把 &lt;code class=&quot;highlighter-rouge&quot;&gt;SLComposeServiceViewController&lt;/code&gt; 改为 &lt;code class=&quot;highlighter-rouge&quot;&gt;UIViewController&lt;/code&gt; ，使用 &lt;code class=&quot;highlighter-rouge&quot;&gt;extensionContext&lt;/code&gt; 属性的 &lt;code class=&quot;highlighter-rouge&quot;&gt;- (void)cancelRequestWithError:&lt;/code&gt; 或者 `` 方法就可以让分享视图消失了。&lt;/p&gt;

&lt;p&gt;Demo: &lt;a href=&quot;https://github.com/monkey19911021/MKShareExtension&quot;&gt;MKShareExtension&lt;/a&gt;
&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;参考链接：
&lt;br /&gt;
&lt;a href=&quot;http://www.cocoachina.com/ios/20140923/9728.html&quot;&gt;CocoaChina&lt;/a&gt;
&lt;br /&gt;
&lt;a href=&quot;http://www.devtalking.com/articles/ios8-day-by-day-day2-sharing-extension/&quot;&gt;iOS8 分享应用扩展&lt;/a&gt;
&lt;br /&gt;
&lt;a href=&quot;http://www.jianshu.com/p/99d4ec43fd65&quot;&gt;简书&lt;/a&gt;
&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;P.S. 喜欢就分享或者点个赞呗&lt;/p&gt;

&lt;!-- 多说评论框 start --&gt;
&lt;div class=&quot;ds-thread&quot; data-thread-key=&quot;ShareExtension&quot; data-title=&quot;ShareExtension&quot; data-url=&quot;http://mkapple.cn/2016/06/23/ShareExtension&quot;&gt;&lt;/div&gt;
&lt;!-- 多说评论框 end --&gt;
&lt;!-- 多说公共JS代码 start (一个网页只需插入一次) --&gt;
&lt;script type=&quot;text/javascript&quot;&gt;
var duoshuoQuery = {short_name:&quot;mkapple&quot;};
	(function() {
		var ds = document.createElement(&#39;script&#39;);
		ds.type = &#39;text/javascript&#39;;ds.async = true;
		ds.src = (document.location.protocol == &#39;https:&#39; ? &#39;https:&#39; : &#39;http:&#39;) + &#39;//static.duoshuo.com/embed.js&#39;;
		ds.charset = &#39;UTF-8&#39;;
		(document.getElementsByTagName(&#39;head&#39;)[0] 
		 || document.getElementsByTagName(&#39;body&#39;)[0]).appendChild(ds);
	})();
	&lt;/script&gt;

&lt;!-- 多说公共JS代码 end --&gt;</content><author><name>M0nk1y</name><email>monkey19911021@gmail.com</email></author><category term="ShareExtension" /><category term="Extension" /><summary></summary></entry><entry><title>应用扩展—— today extension</title><link href="/2016/06/20/TodayExtension" rel="alternate" type="text/html" title="应用扩展—— `today extension`" /><published>2016-06-20T00:00:00+08:00</published><updated>2016-06-20T00:00:00+08:00</updated><id>/2016/06/20/应用扩展—— `Today Extension`</id><content type="html" xml:base="/2016/06/20/TodayExtension">&lt;p&gt;&lt;img src=&quot;/images/MKTodayExtension/img0.PNG&quot; alt=&quot;截图1&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;section&quot;&gt;今日面板&lt;/h2&gt;
&lt;p&gt;      今日面板属于一个应用的扩展，但是该扩展跟该应用是两个独立的程序。OK，来做一个任务列表（ToDoList）来熟悉 Today Extension 的开发吧。&lt;/p&gt;

&lt;h3 id=&quot;section-1&quot;&gt;1. 创建一个任务列表：&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;/images/MKTodayExtension/img1.png&quot; alt=&quot;截图2&quot; /&gt;
&lt;br /&gt;
一个基本的 tableView ，具有点击右上角添加新元素、左滑 tableViewCell 删除元素的，so easy。&lt;/p&gt;

&lt;h3 id=&quot;today-extension-&quot;&gt;2. 创建 Today Extension 扩展&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;/images/MKTodayExtension/img2.png&quot; alt=&quot;截图3&quot; /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;img src=&quot;/images/MKTodayExtension/img3.png&quot; alt=&quot;截图4&quot; /&gt;
&lt;br /&gt;
下一步，命名，完成。
&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;会弹出这样一个框：
&lt;br /&gt;
&lt;img src=&quot;/images/MKTodayExtension/img4.png&quot; alt=&quot;截图5&quot; /&gt;
&lt;br /&gt;
选择激活（Activate）
&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;修改运行时执行的主应用
&lt;br /&gt;
&lt;img src=&quot;/images/MKTodayExtension/img5.png&quot; alt=&quot;截图6&quot; /&gt;
&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;在 Run 一项里选择运行时执行的主应用：&lt;br /&gt;
&lt;img src=&quot;/images/MKTodayExtension/img6.png&quot; alt=&quot;截图7&quot; /&gt;
&lt;br /&gt;
勾上 Debug executable &lt;br /&gt; 
&lt;img src=&quot;/images/MKTodayExtension/img7.png&quot; alt=&quot;截图8&quot; /&gt;
&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;修改在今日面板显示的标题：
&lt;br /&gt;
&lt;img src=&quot;/images/MKTodayExtension/img8.png&quot; alt=&quot;截图9&quot; /&gt;
&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;运行扩展看看：
&lt;br /&gt;
&lt;img src=&quot;/images/MKTodayExtension/img9.png&quot; alt=&quot;截图10&quot; /&gt;
&lt;br /&gt;&lt;/p&gt;

&lt;h3 id=&quot;tableview&quot;&gt;3. 在扩展中创建 tableView&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;/images/MKTodayExtension/img10.png&quot; alt=&quot;截图11&quot; /&gt;
&lt;br /&gt;
如同平常一样，塞一个 tableView 到 sb 里面，接着注意了，在扩展想要修改显示的视图大小需要在 viewControll 里设置 &lt;code class=&quot;highlighter-rouge&quot;&gt;preferredContentSize&lt;/code&gt; 属性：&lt;/p&gt;

&lt;div class=&quot;language-objc highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;preferredContentSize&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CGSizeMake&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;todoList&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;count&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;44&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;section-2&quot;&gt;4. 扩展使用主应用的共享数据&lt;/h3&gt;
&lt;p&gt;由于扩展和主应用是相互独立的程序，所以需要主应用共享出数据给扩展使用，使用&lt;code class=&quot;highlighter-rouge&quot;&gt;App Group&lt;/code&gt;来解决问题。
&lt;br /&gt;
&lt;code class=&quot;highlighter-rouge&quot;&gt;TARGETS&lt;/code&gt; ——&amp;gt; &lt;code class=&quot;highlighter-rouge&quot;&gt;主应用&lt;/code&gt; ——&amp;gt; &lt;code class=&quot;highlighter-rouge&quot;&gt;Capabilities&lt;/code&gt; ——&amp;gt; &lt;code class=&quot;highlighter-rouge&quot;&gt;App Group&lt;/code&gt;
&lt;br /&gt;
点击开启
&lt;br /&gt;
&lt;img src=&quot;/images/MKTodayExtension/img11.png&quot; alt=&quot;截图12&quot; /&gt;
&lt;br /&gt;
输入：group.BundleID
&lt;br /&gt;
&lt;br /&gt;
主应用同步数据到 group&lt;/p&gt;

&lt;div class=&quot;language-objc highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;updateTodoSnapshot&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;NSUserDefaults&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;infoDic&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSUserDefaults&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;alloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;initWithSuiteName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;GROUP_ID&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;infoDic&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;setObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;todoList&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;forKey&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;TODO_LIST_ID&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;infoDic&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;synchronize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;//更新今日面板信息，NotificationCenter framework
&lt;/span&gt;    &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NCWidgetController&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;widgetController&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;setHasContent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;YES&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;forWidgetWithBundleIdentifier&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;@&quot;com.donlinks.MKTodyExtension.MKTodayTarget&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;当 group 数据更新了，扩展会调用 &lt;code class=&quot;highlighter-rouge&quot;&gt;NCWidgetProviding&lt;/code&gt; 协议，实现该协议的两个方法&lt;/p&gt;

&lt;div class=&quot;language-objc highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;widgetPerformUpdateWithCompletionHandler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NCUpdateResult&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;completionHandler&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;loadContents&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;completionHandler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NCUpdateResultNewData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UIEdgeInsets&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;widgetMarginInsetsForProposedMarginInsets&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UIEdgeInsets&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;defaultMarginInsets&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;UIEdgeInsetsMake&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;27&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;第一个方法是系统通知扩展要更新时，扩展调用的方法；第二个方法返回一个内补大小，如果不实现，默认情况视图左侧会有一定的缩进。
&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;扩展获取同步数据&lt;/p&gt;

&lt;div class=&quot;language-objc highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;NSUserDefaults&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;infoDic&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSUserDefaults&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;alloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;initWithSuiteName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;GROUP_ID&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;todoList&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;infoDic&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;objectForKey&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TODO_LIST_ID&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;OK, 演示一遍：
&lt;br /&gt;
&lt;img src=&quot;/images/MKTodayExtension/img12.gif&quot; alt=&quot;截图13&quot; /&gt;
&lt;br /&gt;&lt;/p&gt;

&lt;h3 id=&quot;section-3&quot;&gt;5. 扩展调起主应用&lt;/h3&gt;
&lt;p&gt;首先，给主应用注册一个 URL Scheme
&lt;img src=&quot;/images/MKTodayExtension/img13.png&quot; alt=&quot;截图14&quot; /&gt;
&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;点击今日面板时打开主应用&lt;/p&gt;

&lt;div class=&quot;language-objc highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;tableView&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UITableView&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tableView&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;didSelectRowAtIndexPath&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSIndexPath&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;indexPath&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tableView&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;deselectRowAtIndexPath&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;indexPath&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;animated&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;YES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    
    &lt;span class=&quot;n&quot;&gt;NSString&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;text&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;todoList&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;indexPath&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;row&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;text&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;isEqualToString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;@&quot;添加ToDo&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]){&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;text&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;@&quot;new_item&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;NSUserDefaults&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;infoDic&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSUserDefaults&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;alloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;initWithSuiteName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;GROUP_ID&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;NSArray&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;array&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;infoDic&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;objectForKey&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TODO_LIST_ID&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
        
        &lt;span class=&quot;n&quot;&gt;text&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSString&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;stringWithFormat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;@&quot;%@&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;array&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;indexOfObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;text&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])];&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;n&quot;&gt;NSString&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;urlStr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;@&quot;MKToday://&quot;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;stringByAppendingString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;text&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;//打开主应用
&lt;/span&gt;    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;extensionContext&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;openURL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSURL&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;URLWithString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;urlStr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;completionHandler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;演示：
&lt;br /&gt;
&lt;img src=&quot;/images/MKTodayExtension/img14.gif&quot; alt=&quot;截图15&quot; /&gt;
&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;OK, 打完收工，Demo在此：&lt;a href=&quot;https://github.com/monkey19911021/MKTodyExtension&quot;&gt;MKTodyExtension&lt;/a&gt;
&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;参考链接：
&lt;br /&gt;
&lt;a href=&quot;https://developer.apple.com/library/ios/documentation/NotificationCenter/Reference/NotificationCenter_Framework/index.html&quot;&gt;苹果官方文档&lt;/a&gt;
&lt;br /&gt;
&lt;a href=&quot;http://www.cocoachina.com/ios/20140904/9527.html&quot;&gt;App Extension编程指南&lt;/a&gt;
&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;P.S. 喜欢就分享或者点个赞呗&lt;/p&gt;

&lt;!-- 多说评论框 start --&gt;
&lt;div class=&quot;ds-thread&quot; data-thread-key=&quot;TodayExtension&quot; data-title=&quot;TodayExtension&quot; data-url=&quot;http://mkapple.cn/2016/06/20/TodayExtension&quot;&gt;&lt;/div&gt;
&lt;!-- 多说评论框 end --&gt;
&lt;!-- 多说公共JS代码 start (一个网页只需插入一次) --&gt;
&lt;script type=&quot;text/javascript&quot;&gt;
var duoshuoQuery = {short_name:&quot;mkapple&quot;};
	(function() {
		var ds = document.createElement(&#39;script&#39;);
		ds.type = &#39;text/javascript&#39;;ds.async = true;
		ds.src = (document.location.protocol == &#39;https:&#39; ? &#39;https:&#39; : &#39;http:&#39;) + &#39;//static.duoshuo.com/embed.js&#39;;
		ds.charset = &#39;UTF-8&#39;;
		(document.getElementsByTagName(&#39;head&#39;)[0] 
		 || document.getElementsByTagName(&#39;body&#39;)[0]).appendChild(ds);
	})();
	&lt;/script&gt;

&lt;!-- 多说公共JS代码 end --&gt;</content><author><name>M0nk1y</name><email>monkey19911021@gmail.com</email></author><category term="TodayExtension" /><category term="Extension" /><summary></summary></entry><entry><title>应用内搜索 ——corespotlight</title><link href="/2016/06/17/CoreSpotlight" rel="alternate" type="text/html" title="应用内搜索 ——`corespotlight`" /><published>2016-06-17T00:00:00+08:00</published><updated>2016-06-17T00:00:00+08:00</updated><id>/2016/06/17/应用内搜索 ——`CoreSpotlight`</id><content type="html" xml:base="/2016/06/17/CoreSpotlight">&lt;p&gt;&lt;img src=&quot;/images/CoreSpotlight/corespotlight.png&quot; alt=&quot;截图1&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;frameworkbr&quot;&gt;1. 先将framework导入：&lt;br /&gt;&lt;/h3&gt;
&lt;p&gt;工程 -&amp;gt; Build Phases -&amp;gt; Link Binary With Libraries-&amp;gt;&lt;img src=&quot;/images/CoreSpotlight/image2.png&quot; alt=&quot;截图2&quot; /&gt;
&lt;br /&gt;&lt;/p&gt;

&lt;h3 id=&quot;section&quot;&gt;2. 创建搜索项&lt;/h3&gt;

&lt;h4 id=&quot;section-1&quot;&gt;2.1. 导入头文件&lt;/h4&gt;

&lt;div class=&quot;language-objc highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;#import &amp;lt;CoreSpotlight/CoreSpotlight.h&amp;gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h4 id=&quot;section-2&quot;&gt;2.2. 创建搜索项&lt;/h4&gt;

&lt;div class=&quot;language-objc highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;NSMutableArray&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CSSearchableItem&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;array&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;@[].&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mutableCopy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    
&lt;span class=&quot;c1&quot;&gt;//创建 SearchableItemAttributeSet
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CSSearchableItemAttributeSet&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CSSearchableItemAttributeSet&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;alloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;initWithItemContentType&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;@&quot;views&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;title&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;@&quot;打开MKApple&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;contentDescription&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;@&quot;在应用里打开MKApple的网站&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;thumbnailData&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;UIImagePNGRepresentation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UIImage&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;imageNamed&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;@&quot;fielIcon&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]);&lt;/span&gt;
    
&lt;span class=&quot;c1&quot;&gt;//创建 SearchableItem
&lt;/span&gt;&lt;span class=&quot;cm&quot;&gt;/*
 uniqueIdentifier: 搜索项唯一标识符
 domainIdentifier: 搜索项的域标识，用于批量操作搜索项
*/&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;CSSearchableItem&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;item&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CSSearchableItem&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;alloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;initWithUniqueIdentifier&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;@&quot;MKUnique&quot;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;domainIdentifier&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;@&quot;MKDomain&quot;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;attributeSet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;array&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;addObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    
&lt;span class=&quot;c1&quot;&gt;//更新搜索项
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CSSearchableIndex&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;defaultSearchableIndex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;indexSearchableItems&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;array&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;completionHandler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSError&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_Nullable&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        
&lt;span class=&quot;p&quot;&gt;}];&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;appdelegate--spotlight-&quot;&gt;3. AppDelegate 中实现 spotlight 点击进来的事件&lt;/h3&gt;

&lt;div class=&quot;language-objc highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;BOOL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;application&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UIApplication&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;application&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;continueUserActivity&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSUserActivity&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;userActivity&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;restorationHandler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSArray&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_Nullable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;restorationHandler&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;NSString&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;identifier&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;userActivity&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;userInfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;CSSearchableItemActivityIdentifier&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;identifier&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;isEqualToString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;@&quot;打开MKApple&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]){&lt;/span&gt;
        
        &lt;span class=&quot;n&quot;&gt;UIViewController&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rootViewCtrl&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rootViewController&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        
        &lt;span class=&quot;n&quot;&gt;__block&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;UIViewController&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ctrl&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UIViewController&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
        
        &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rootViewCtrl&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;presentViewController&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ctrl&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;animated&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;YES&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;completion&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            
            &lt;span class=&quot;n&quot;&gt;UIWebView&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;webView&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UIWebView&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;alloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;initWithFrame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ctrl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;view&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bounds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;webView&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;sizeToFit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;webView&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;scalesPageToFit&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;YES&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;webView&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;loadRequest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSURLRequest&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;requestWithURL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSURL&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;URLWithString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;@&quot;http://mkapple.cn&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]]]&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ctrl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;view&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;addSubview&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;webView&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;;&lt;/span&gt;
            
        &lt;span class=&quot;p&quot;&gt;}];&lt;/span&gt;
        
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;YES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;section-3&quot;&gt;4. 删除搜索项&lt;/h3&gt;
&lt;div class=&quot;language-objc highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;//通过 uniqueIdentifier 删除
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CSSearchableIndex&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;defaultSearchableIndex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;deleteSearchableItemsWithIdentifiers&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:@[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;@&quot;MKUnique&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;completionHandler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSError&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_Nullable&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        
&lt;span class=&quot;p&quot;&gt;}];&lt;/span&gt;
    
&lt;span class=&quot;c1&quot;&gt;//通过 domainIdentifier 删除
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CSSearchableIndex&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;defaultSearchableIndex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;deleteSearchableItemsWithDomainIdentifiers&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:@[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;@&quot;MKDomain&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;completionHandler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSError&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_Nullable&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        
&lt;span class=&quot;p&quot;&gt;}];&lt;/span&gt;
    
&lt;span class=&quot;c1&quot;&gt;//删除本应用所有的索引
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CSSearchableIndex&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;defaultSearchableIndex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;deleteAllSearchableItemsWithCompletionHandler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSError&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_Nullable&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        
&lt;span class=&quot;p&quot;&gt;}];&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;!-- 多说评论框 start --&gt;
&lt;div class=&quot;ds-thread&quot; data-thread-key=&quot;CoreSpotlight&quot; data-title=&quot;CoreSpotlight&quot; data-url=&quot;http://mkapple.cn/2016/06/17/CoreSpotlight&quot;&gt;&lt;/div&gt;
&lt;!-- 多说评论框 end --&gt;
&lt;!-- 多说公共JS代码 start (一个网页只需插入一次) --&gt;
&lt;script type=&quot;text/javascript&quot;&gt;
var duoshuoQuery = {short_name:&quot;mkapple&quot;};
	(function() {
		var ds = document.createElement(&#39;script&#39;);
		ds.type = &#39;text/javascript&#39;;ds.async = true;
		ds.src = (document.location.protocol == &#39;https:&#39; ? &#39;https:&#39; : &#39;http:&#39;) + &#39;//static.duoshuo.com/embed.js&#39;;
		ds.charset = &#39;UTF-8&#39;;
		(document.getElementsByTagName(&#39;head&#39;)[0] 
		 || document.getElementsByTagName(&#39;body&#39;)[0]).appendChild(ds);
	})();
	&lt;/script&gt;

&lt;!-- 多说公共JS代码 end --&gt;</content><author><name>M0nk1y</name><email>monkey19911021@gmail.com</email></author><category term="CoreSpotlight" /><summary></summary></entry><entry><title>基于 xcode7 的 framework 开发技术</title><link href="/160504Framework" rel="alternate" type="text/html" title="基于 xcode7 的 framework 开发技术" /><published>2016-05-04T00:00:00+08:00</published><updated>2016-05-04T00:00:00+08:00</updated><id>/基于 Xcode7 的 framework 开发技术</id><content type="html" xml:base="/160504Framework">&lt;aside class=&quot;sidebar__right&quot;&gt;
&lt;nav class=&quot;toc&quot;&gt;
    &lt;header&gt;&lt;h4 class=&quot;nav__title&quot;&gt;&lt;i class=&quot;fa fa-gears&quot;&gt;&lt;/i&gt; 目录&lt;/h4&gt;&lt;/header&gt;
&lt;ul class=&quot;toc__menu&quot; id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#section&quot; id=&quot;markdown-toc-section&quot;&gt;1.  静态库和动态库&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#section-1&quot; id=&quot;markdown-toc-section-1&quot;&gt;1.1  什么是静态库&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-2&quot; id=&quot;markdown-toc-section-2&quot;&gt;1.2  什么是动态库&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-3&quot; id=&quot;markdown-toc-section-3&quot;&gt;1.3  选择哪种库&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-4&quot; id=&quot;markdown-toc-section-4&quot;&gt;2.  制作动态库&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#framework&quot; id=&quot;markdown-toc-framework&quot;&gt;2.1  选择framework项目&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-5&quot; id=&quot;markdown-toc-section-5&quot;&gt;2.2  创建通用集合&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-6&quot; id=&quot;markdown-toc-section-6&quot;&gt;2.3  添加项目依赖&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-7&quot; id=&quot;markdown-toc-section-7&quot;&gt;2.4  添加运行脚本&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-8&quot; id=&quot;markdown-toc-section-8&quot;&gt;2.5  设置证书&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-9&quot; id=&quot;markdown-toc-section-9&quot;&gt;2.6  编译&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-10&quot; id=&quot;markdown-toc-section-10&quot;&gt;3.  动态库工程联编&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#section-11&quot; id=&quot;markdown-toc-section-11&quot;&gt;3.1  导入动态库项目&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-12&quot; id=&quot;markdown-toc-section-12&quot;&gt;3.2  设置项目依赖&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-13&quot; id=&quot;markdown-toc-section-13&quot;&gt;3.3  项目设置&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-14&quot; id=&quot;markdown-toc-section-14&quot;&gt;4.  制作静态库&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#section-15&quot; id=&quot;markdown-toc-section-15&quot;&gt;4.1  项目设置&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-16&quot; id=&quot;markdown-toc-section-16&quot;&gt;4.2  设置开放头文件&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-17&quot; id=&quot;markdown-toc-section-17&quot;&gt;4.3  制作资源包&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-18&quot; id=&quot;markdown-toc-section-18&quot;&gt;5.  静态库工程联编&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#section-19&quot; id=&quot;markdown-toc-section-19&quot;&gt;5.1  把资源包放到项目中&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-20&quot; id=&quot;markdown-toc-section-20&quot;&gt;5.2  设置连接方式&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-21&quot; id=&quot;markdown-toc-section-21&quot;&gt;6.  静态库一秒变动态库&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#section-22&quot; id=&quot;markdown-toc-section-22&quot;&gt;6.1  基本设置&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-23&quot; id=&quot;markdown-toc-section-23&quot;&gt;6.2  设置静态库的编译类型为动态&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

  &lt;/nav&gt;
&lt;/aside&gt;

&lt;h2 id=&quot;section&quot;&gt;1.  静态库和动态库&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;Static Library （.a）&lt;/li&gt;
  &lt;li&gt;Dynamic Library (.dylib)&lt;/li&gt;
  &lt;li&gt;Static Framework (.framework)&lt;/li&gt;
  &lt;li&gt;Dynamic Framework (.framework)&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;section-1&quot;&gt;1.1  什么是静态库&lt;/h3&gt;
&lt;p&gt;程序编译一般需经预处理、编译、汇编和链接几个步骤。在我们的应用中，有一些公共代码是需要反复使用，就把这些代码编译为“库”文件；在链接步骤中，连接器将从库文件取得所需的代码，复制到生成的可执行文件中。这种库称为静态库，其特点是可执行文件中包含了库代码的一份完整拷贝；缺点就是被多次使用就会有多份冗余拷贝。&lt;/p&gt;

&lt;h3 id=&quot;section-2&quot;&gt;1.2  什么是动态库&lt;/h3&gt;
&lt;p&gt;动态库功能跟静态库类似，也是为了代码复用。静态库在程序的链接阶段被复制到了程序中，和程序运行的时候没有关系；动态库在链接阶段没有被复制到程序中，而是程序在运行时由系统动态加载到内存中供程序调用。使用动态库的优点是系统只需载入一次动态库，不同的程序可以得到内存中相同的动态库的复本，因此节省了很多内存。&lt;/p&gt;

&lt;h3 id=&quot;section-3&quot;&gt;1.3  选择哪种库&lt;/h3&gt;
&lt;p&gt;由于Appstore不支持上传包含动态库的app（其原因百度之），所以我们在开发app之前我们需要考虑好，app上架到哪里，动态更新功能是否必不可少。如果只上架到AppStore则只能是用静态库；如果只上架到本地服务器则可以使用动态库和静态库；如果不但要上架到而且还要上架到本地服务器让它具有动态更新功能的，则这个库则需要做得想静态库一样的动态库，我们只需要为静态库做一点小改动则可以变成动态库。&lt;/p&gt;

&lt;h2 id=&quot;section-4&quot;&gt;2.  制作动态库&lt;/h2&gt;

&lt;h3 id=&quot;framework&quot;&gt;2.1  选择framework项目&lt;/h3&gt;
&lt;p&gt;framework一般用于开发动态库
&lt;img src=&quot;/images/MKExceptionImg/MKExceptionImg1.png&quot; alt=&quot;截图2.1.1&quot; /&gt;&lt;/p&gt;

&lt;p&gt;命名为：FrameworkTest
&lt;img src=&quot;/images/MKExceptionImg/MKExceptionImg2.png&quot; alt=&quot;截图2.1.2&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;section-5&quot;&gt;2.2  创建通用集合&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;/images/MKExceptionImg/MKExceptionImg3.png&quot; alt=&quot;截图2.2.1&quot; /&gt;&lt;/p&gt;

&lt;p&gt;命名为项目名+Aggregate：FrameworkTestAggregate
&lt;img src=&quot;/images/MKExceptionImg/MKExceptionImg4.png&quot; alt=&quot;截图2.2.2&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;section-6&quot;&gt;2.3  添加项目依赖&lt;/h3&gt;
&lt;p&gt;Build Phases ——&amp;gt; Target Dependencies ——&amp;gt; +
&lt;img src=&quot;/images/MKExceptionImg/MKExceptionImg5.png&quot; alt=&quot;截图2.3.1&quot; /&gt;&lt;/p&gt;

&lt;p&gt;选择本项目
&lt;img src=&quot;/images/MKExceptionImg/MKExceptionImg6.png&quot; alt=&quot;截图2.3.2&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;section-7&quot;&gt;2.4  添加运行脚本&lt;/h3&gt;
&lt;p&gt;Build Phases ——&amp;gt; + ——&amp;gt; New Run Script Phase
&lt;img src=&quot;/images/MKExceptionImg/MKExceptionImg7.png&quot; alt=&quot;截图2.4.1&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/MKExceptionImg/MKExceptionImg8.png&quot; alt=&quot;截图2.4.2&quot; /&gt;&lt;/p&gt;

&lt;p&gt;添加如下脚本代码：&lt;/p&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# Sets the target folders and the final framework product.&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;FMK_NAME&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;PROJECT_NAME&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# Install dir will be the final output to the framework.&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# The following line create it in the root folder of the current project.&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;INSTALL_DIR&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;SRCROOT&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;/Products/&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;FMK_NAME&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;.framework

&lt;span class=&quot;c&quot;&gt;# Working dir will be deleted after the framework creation.&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;WRK_DIR&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;build
&lt;span class=&quot;nv&quot;&gt;DEVICE_DIR&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;WRK_DIR&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;/Release-iphoneos/&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;FMK_NAME&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;.framework
&lt;span class=&quot;nv&quot;&gt;SIMULATOR_DIR&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;WRK_DIR&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;/Release-iphonesimulator/&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;FMK_NAME&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;.framework

&lt;span class=&quot;c&quot;&gt;# -configuration ${CONFIGURATION}&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# Clean and Building both architectures.&lt;/span&gt;
xcodebuild -configuration &lt;span class=&quot;s2&quot;&gt;&quot;Release&quot;&lt;/span&gt; -target &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;FMK_NAME&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; -sdk iphoneos clean build
xcodebuild -configuration &lt;span class=&quot;s2&quot;&gt;&quot;Release&quot;&lt;/span&gt; -target &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;FMK_NAME&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; -sdk iphonesimulator clean build

&lt;span class=&quot;c&quot;&gt;# Cleaning the oldest.&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; -d &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;INSTALL_DIR&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;then
&lt;/span&gt;rm -rf &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;INSTALL_DIR&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;fi

&lt;/span&gt;mkdir -p &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;INSTALL_DIR&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;

cp -R &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;DEVICE_DIR&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/&quot;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;INSTALL_DIR&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/&quot;&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# Uses the Lipo Tool to merge both binary files (i386 + armv6/armv7) into one Universal final product.&lt;/span&gt;
lipo -create &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;DEVICE_DIR&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;FMK_NAME&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;SIMULATOR_DIR&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;FMK_NAME&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; -output &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;INSTALL_DIR&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;FMK_NAME&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;

rm -r &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;WRK_DIR&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/images/MKExceptionImg/MKExceptionImg9.png&quot; alt=&quot;截图2.4.3&quot; /&gt;&lt;/p&gt;

&lt;p&gt;作用是把编译后的库代码的模拟器版本和真机版本合并成一个通用版本，使此库能运行在模拟器和真机上。并且把生成的库放在项目文件夹里的Products文件夹。&lt;/p&gt;

&lt;h3 id=&quot;section-8&quot;&gt;2.5  设置证书&lt;/h3&gt;
&lt;p&gt;为了此动态库能运行在普通的iPhone上，需要为动态库像app一样设置开发证书和发布证书。
&lt;img src=&quot;/images/MKExceptionImg/MKExceptionImg10.png&quot; alt=&quot;截图2.5.1&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;section-9&quot;&gt;2.6  编译&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;/images/MKExceptionImg/MKExceptionImg11.png&quot; alt=&quot;截图2.6.1&quot; /&gt;
选择通用库编译。&lt;/p&gt;

&lt;p&gt;Build：
&lt;img src=&quot;/images/MKExceptionImg/MKExceptionImg12.png&quot; alt=&quot;截图2.6.2&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;section-10&quot;&gt;3.  动态库工程联编&lt;/h2&gt;

&lt;h3 id=&quot;section-11&quot;&gt;3.1  导入动态库项目&lt;/h3&gt;
&lt;p&gt;我们新建一个普通app项目来测试此动态库,命名为：&lt;code class=&quot;highlighter-rouge&quot;&gt;TestDynamicFramework&lt;/code&gt;。引入我们刚才的动态库项目&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/MKExceptionImg/MKExceptionImg13.png&quot; alt=&quot;截图3.1.1&quot; /&gt;——&amp;gt;&lt;img src=&quot;/images/MKExceptionImg/MKExceptionImg14.png&quot; alt=&quot;截图3.1.2&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;section-12&quot;&gt;3.2  设置项目依赖&lt;/h3&gt;
&lt;p&gt;导入动态库后可以在添加项目依赖处找到动态库通用集合
&lt;img src=&quot;/images/MKExceptionImg/MKExceptionImg15.png&quot; alt=&quot;截图3.2.1&quot; /&gt;&lt;/p&gt;

&lt;p&gt;把动态库生成的framework文件拖进项目
&lt;img src=&quot;/images/MKExceptionImg/MKExceptionImg16.png&quot; alt=&quot;截图3.2.2&quot; /&gt;&lt;/p&gt;

&lt;p&gt;注意不要选上Copy items if needed&lt;/p&gt;

&lt;h3 id=&quot;section-13&quot;&gt;3.3  项目设置&lt;/h3&gt;
&lt;p&gt;删除Build Phases ——&amp;gt; Link Binary With Libraries下因为刚才拉进来的framework而产生的库连接
&lt;img src=&quot;/images/MKExceptionImg/MKExceptionImg17.png&quot; alt=&quot;截图3.3.1&quot; /&gt;&lt;/p&gt;

&lt;p&gt;在Build Phases ——&amp;gt; Copy Bundle Resources ——&amp;gt; + ；把动态库添加进来，让app编译的时候把动态复制进main bundle。
&lt;img src=&quot;/images/MKExceptionImg/MKExceptionImg18.png&quot; alt=&quot;截图3.3.2&quot; /&gt;&lt;/p&gt;

&lt;p&gt;这样子每次运行app项目的时候都会重新编译动态库，达到可以快速查看动态库的修改。但是每次这样运行app就要重新编译动态库会很耗费时间，所以在不需要修改动态库的时候把项目的动态库依赖给删除。&lt;/p&gt;

&lt;p&gt;*关于如何动态加载动态库以及动态库如何定位资源文件请看Demo。&lt;/p&gt;

&lt;h2 id=&quot;section-14&quot;&gt;4.  制作静态库&lt;/h2&gt;
&lt;p&gt;静态库与动态库的制作方法前5个步骤跟第2节1~6点所讲述的一样，但是静态库需要多执行以下步骤：&lt;/p&gt;

&lt;h3 id=&quot;section-15&quot;&gt;4.1  项目设置&lt;/h3&gt;
&lt;p&gt;打开Build Settings ——&amp;gt; 搜索mach， 在Mach-O Type一栏中选择Static Library
&lt;img src=&quot;/images/MKExceptionImg/MKExceptionImg19.png&quot; alt=&quot;截图4.1.1&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;section-16&quot;&gt;4.2  设置开放头文件&lt;/h3&gt;
&lt;p&gt;打开Build Phases ——&amp;gt; Headers，把Project中的需要对外开放的头文件拖到Public中。
&lt;img src=&quot;/images/MKExceptionImg/MKExceptionImg20.png&quot; alt=&quot;截图4.2.1&quot; /&gt;&lt;/p&gt;

&lt;p&gt;在与项目名相同的头文件中设置开放的头文件
&lt;img src=&quot;/images/MKExceptionImg/MKExceptionImg21.png&quot; alt=&quot;截图4.2.2&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;section-17&quot;&gt;4.3  制作资源包&lt;/h3&gt;
&lt;p&gt;由于静态库属于静态连接，资源文件都需要放到bundle中，让其他项目主动加载它，静态库中的对象才能找到这些资源文件。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/MKExceptionImg/MKExceptionImg22.png&quot; alt=&quot;截图4.3.1&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/MKExceptionImg/MKExceptionImg23.png&quot; alt=&quot;截图4.3.2&quot; /&gt;&lt;/p&gt;

&lt;p&gt;设置bundle的bitcode为No。
&lt;img src=&quot;/images/MKExceptionImg/MKExceptionImg24.png&quot; alt=&quot;截图4.3.3&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Base SDK 设置为iOS的。
&lt;img src=&quot;/images/MKExceptionImg/MKExceptionImg25.png&quot; alt=&quot;截图4.3.4&quot; /&gt;&lt;/p&gt;

&lt;p&gt;把资源文件添加进Build Phases ——&amp;gt; Copy Bundle Resources
&lt;img src=&quot;/images/MKExceptionImg/MKExceptionImg26.png&quot; alt=&quot;截图4.3.5&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/MKExceptionImg/MKExceptionImg27.png&quot; alt=&quot;截图4.3.6&quot; /&gt;&lt;/p&gt;

&lt;div class=&quot;language-objc highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;//获取该bundle对象代码：
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSBundle&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bundle&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSBundle&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;bundleWithURL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSBundle&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;mainBundle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;URLForResource&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;@&quot;StaticFrameworkTestBundle&quot;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;withExtension&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;@&quot;bundle&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]];&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;section-18&quot;&gt;5.  静态库工程联编&lt;/h2&gt;
&lt;p&gt;静态库工程联编方式跟动态库工程联编方式基本一样，参考第3节1~2点，但需要加上以下步骤：&lt;/p&gt;

&lt;h3 id=&quot;section-19&quot;&gt;5.1  把资源包放到项目中&lt;/h3&gt;
&lt;p&gt;使用真机把资源包编译一下
&lt;img src=&quot;/images/MKExceptionImg/MKExceptionImg28.png&quot; alt=&quot;截图5.1&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/MKExceptionImg/MKExceptionImg29.png&quot; alt=&quot;截图5.2&quot; /&gt;&lt;/p&gt;

&lt;p&gt;把这资源包拖进项目但不要复制。&lt;/p&gt;

&lt;h3 id=&quot;section-20&quot;&gt;5.2  设置连接方式&lt;/h3&gt;
&lt;p&gt;Build Setting ——&amp;gt; 搜索other linker ——&amp;gt; 在Other Linker Flags 中添加-all_load。目的是为了把静态库中所有的类包括没有直接使用的类创建连接符，让项目可以加载所有的类。
&lt;img src=&quot;/images/MKExceptionImg/MKExceptionImg30.png&quot; alt=&quot;截图5.2.1&quot; /&gt;&lt;/p&gt;

&lt;p&gt;OK, Run！。&lt;/p&gt;

&lt;h2 id=&quot;section-21&quot;&gt;6.  静态库一秒变动态库&lt;/h2&gt;

&lt;h3 id=&quot;section-22&quot;&gt;6.1  基本设置&lt;/h3&gt;
&lt;p&gt;在Build Settings ——&amp;gt; 搜索Preprocessor Macros ——&amp;gt; Debug和Release两项中分别都添加useStaticFramework=1。意思是useStaticFramework=1时使用静态库，useStaticFramework=0时使用动态库。
&lt;img src=&quot;/images/MKExceptionImg/MKExceptionImg31.png&quot; alt=&quot;截图6.1.1&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;section-23&quot;&gt;6.2  设置静态库的编译类型为动态&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;/images/MKExceptionImg/MKExceptionImg32.png&quot; alt=&quot;截图6.2.1&quot; /&gt;&lt;/p&gt;

&lt;p&gt;注意：动静并存时：
&lt;img src=&quot;/images/MKExceptionImg/MKExceptionImg33.png&quot; alt=&quot;截图6.2.2&quot; /&gt;&lt;/p&gt;

&lt;p&gt;OK，现在只要修改库的编译类型以及app的useStaticFramework就可以让app项目加载动态库或者静态库了。&lt;/p&gt;

&lt;p&gt;*具体代码参考Demo&lt;/p&gt;

&lt;!-- 多说评论框 start --&gt;
&lt;div class=&quot;ds-thread&quot; data-thread-key=&quot;160504Framework&quot; data-title=&quot;基于Xcode7的Framework开发技术&quot; data-url=&quot;http://mkapple.cn/160504Framework&quot;&gt;&lt;/div&gt;
&lt;!-- 多说评论框 end --&gt;
&lt;!-- 多说公共JS代码 start (一个网页只需插入一次) --&gt;
&lt;script type=&quot;text/javascript&quot;&gt;
var duoshuoQuery = {short_name:&quot;mkapple&quot;};
	(function() {
		var ds = document.createElement(&#39;script&#39;);
		ds.type = &#39;text/javascript&#39;;ds.async = true;
		ds.src = (document.location.protocol == &#39;https:&#39; ? &#39;https:&#39; : &#39;http:&#39;) + &#39;//static.duoshuo.com/embed.js&#39;;
		ds.charset = &#39;UTF-8&#39;;
		(document.getElementsByTagName(&#39;head&#39;)[0] 
		 || document.getElementsByTagName(&#39;body&#39;)[0]).appendChild(ds);
	})();
	&lt;/script&gt;

&lt;!-- 多说公共JS代码 end --&gt;</content><author><name>M0nk1y</name><email>monkey19911021@gmail.com</email></author><category term="Framework" /><summary>目录

  1.  静态库和动态库    
      1.1  什么是静态库
      1.2  什么是动态库
      1.3  选择哪种库
    
  
  2.  制作动态库    
      2.1  选择framework项目
      2.2  创建通用集合
      2.3  添加项目依赖
      2.4  添加运行脚本
    
  


  


1.  静态库和动态库

  Static Library （.a）
  Dynamic Library (.dylib)
  Static Framework (.framework)
  Dynamic Framework (.framework)


1.1  什么是静态库
程序编译一般需经预处理、编译、汇编和链接几个步骤。在我们的应用中，有一些公共代码是需要反复使用，就把这些代码编译为“库”文件；在链接步骤中，连接器将从库文件取得所需的代码，复制到生成的可执行文件中。这种库称为静态库，其特点是可执行文件中包含了库代码的一份完整拷贝；缺点就是被多次使用就会有多份冗余拷贝。

1.2  什么是动态库
动态库功能跟静态库类似，也是为了代码复用。静态库在程序的链接阶段被复制到了程序中，和程序运行的时候没有关系；动态库在链接阶段没有被复制到程序中，而是程序在运行时由系统动态加载到内存中供程序调用。使用动态库的优点是系统只需载入一次动态库，不同的程序可以得到内存中相同的动态库的复本，因此节省了很多内存。

1.3  选择哪种库
由于Appstore不支持上传包含动态库的app（其原因百度之），所以我们在开发app之前我们需要考虑好，app上架到哪里，动态更新功能是否必不可少。如果只上架到AppStore则只能是用静态库；如果只上架到本地服务器则可以使用动态库和静态库；如果不但要上架到而且还要上架到本地服务器让它具有动态更新功能的，则这个库则需要做得想静态库一样的动态库，我们只需要为静态库做一点小改动则可以变成动态库。

2.  制作动态库

2.1  选择framework项目
framework一般用于开发动态库


命名为：FrameworkTest


2.2  创建通用集合


命名为项目名+Aggregate：FrameworkTestAggregate


2.3  添加项目依赖
Build Phases ——&amp;gt; Target Dependencies ——&amp;gt; +


选择本项目


2.4  添加运行脚本
Build Phases ——&amp;gt; + ——&amp;gt; New Run Script Phase




添加如下脚本代码：</summary></entry><entry><title>ios 的异常处理</title><link href="/160504exception" rel="alternate" type="text/html" title="`ios` 的异常处理" /><published>2016-05-04T00:00:00+08:00</published><updated>2016-05-04T00:00:00+08:00</updated><id>/`iOS` 的异常处理</id><content type="html" xml:base="/160504exception">&lt;h2 id=&quot;ios&quot;&gt;iOS异常说明：&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;iOS的异常有两种：&lt;/strong&gt;&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;普通异常，能够被NSException捕获的异常&lt;br /&gt;
对于普通异常我们可以使用NSException来捕获并且进行处理。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;信号机制异常，不能够被NSException捕获的异常，由系统向自身发出闪退信号导致程序崩溃。&lt;br /&gt;
对于信号机制异常，需要用信号处理函数: &lt;code class=&quot;highlighter-rouge&quot;&gt;void	(*signal(int, void (*)(int)))(int);&lt;/code&gt;&lt;br /&gt;&lt;/p&gt;
    &lt;ol&gt;
      &lt;li&gt;为某信号注册处理函数：&lt;code class=&quot;highlighter-rouge&quot;&gt;signal(SIGABRT, SignalHandler);&lt;/code&gt;  为信号SIGABRT注册一个SignalHandler处理方法。&lt;br /&gt;&lt;/li&gt;
      &lt;li&gt;实现SignalHandler方法：&lt;code class=&quot;highlighter-rouge&quot;&gt;void SignalHandler(int signal){//实现方法}；&lt;/code&gt;&lt;/li&gt;
    &lt;/ol&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;uncaughtexceptionhandler&quot;&gt;UncaughtExceptionHandler使用方法：&lt;/h2&gt;
&lt;p&gt;在项目的&lt;code class=&quot;highlighter-rouge&quot;&gt;AppDelegate.m&lt;/code&gt;文件的import进&lt;code class=&quot;highlighter-rouge&quot;&gt;UncaughtExceptionHandler.h&lt;/code&gt;
然后在方法：&lt;code class=&quot;highlighter-rouge&quot;&gt;- (BOOL)application: didFinishLaunchingWithOptions；&lt;/code&gt;里设置全局异常监控方法：&lt;code class=&quot;highlighter-rouge&quot;&gt;InstallUncaughtExceptionHandler();&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;每当异常出现就会弹出一个异常提示框告诉用户软件出现崩溃了，之后程序就会闪退了，并且会在程序的Documents文件夹里生成命名格式为：Exception+时间的异常日志。&lt;/p&gt;

&lt;p&gt;之后需要添加异常日志发送功能，这样开发者就能立即修复软件的错误。&lt;/p&gt;

&lt;p&gt;Demo: &lt;a href=&quot;https://github.com/monkey19911021/MKExceptionHandlerDemo&quot;&gt;MKExceptionHandlerDemo&lt;/a&gt;&lt;/p&gt;

&lt;!-- 多说评论框 start --&gt;
&lt;div class=&quot;ds-thread&quot; data-thread-key=&quot;160504exception&quot; data-title=&quot;iOS 的异常处理&quot; data-url=&quot;http://mkapple.cn/160504exception&quot;&gt;&lt;/div&gt;
&lt;!-- 多说评论框 end --&gt;
&lt;!-- 多说公共JS代码 start (一个网页只需插入一次) --&gt;
&lt;script type=&quot;text/javascript&quot;&gt;
var duoshuoQuery = {short_name:&quot;mkapple&quot;};
	(function() {
		var ds = document.createElement(&#39;script&#39;);
		ds.type = &#39;text/javascript&#39;;ds.async = true;
		ds.src = (document.location.protocol == &#39;https:&#39; ? &#39;https:&#39; : &#39;http:&#39;) + &#39;//static.duoshuo.com/embed.js&#39;;
		ds.charset = &#39;UTF-8&#39;;
		(document.getElementsByTagName(&#39;head&#39;)[0] 
		 || document.getElementsByTagName(&#39;body&#39;)[0]).appendChild(ds);
	})();
	&lt;/script&gt;

&lt;!-- 多说公共JS代码 end --&gt;</content><author><name>M0nk1y</name><email>monkey19911021@gmail.com</email></author><category term="Exception" /><category term="SignalHandler" /><summary>iOS异常说明：
iOS的异常有两种：


  
    普通异常，能够被NSException捕获的异常
对于普通异常我们可以使用NSException来捕获并且进行处理。
  
  
    信号机制异常，不能够被NSException捕获的异常，由系统向自身发出闪退信号导致程序崩溃。
对于信号机制异常，需要用信号处理函数: void	(*signal(int, void (*)(int)))(int);
    
      为某信号注册处理函数：signal(SIGABRT, SignalHandler);  为信号SIGABRT注册一个SignalHandler处理方法。
      实现SignalHandler方法：void SignalHandler(int signal){//实现方法}；
    
  


UncaughtExceptionHandler使用方法：
在项目的AppDelegate.m文件的import进UncaughtExceptionHandler.h
然后在方法：- (BOOL)application: didFinishLaunchingWithOptions；里设置全局异常监控方法：InstallUncaughtExceptionHandler();

每当异常出现就会弹出一个异常提示框告诉用户软件出现崩溃了，之后程序就会闪退了，并且会在程序的Documents文件夹里生成命名格式为：Exception+时间的异常日志。

之后需要添加异常日志发送功能，这样开发者就能立即修复软件的错误。</summary></entry></feed>
